<!DOCTYPE html>
<html lang="zh-CN">
<head>
<link rel="icon" href="favicon.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据处理工具集</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        neutral: '#6B7280',
                        accent: '#10b981',
                        danger: '#ef4444',
                        fnsku: '#eff6ff', // 表格工具新增颜色
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
@layer utilities {
    .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .transition-height {
        transition: height 0.3s ease;
    }
    .content-auto {
        content-visibility: auto;
    }
    .tab-active {
        @apply border-primary text-primary bg-blue-50;
    }
    /* 新增：MSKU结果表格容器样式 */
    .msku-result-container {
        max-height: 600px; /* 最大高度，超出则滚动 */
        overflow-y: auto;  /* 垂直滚动 */
    }
    .sticky-header th {
        position: sticky;  /* 表头固定 */
        top: 0;
        background-color: #f9fafb; /* 与表格背景一致 */
        z-index: 10;
    }
    /* 表格工具新增样式 */
    .table-cell-hover {
        @apply hover:bg-blue-50 transition-colors;
    }
    .btn-active {
        @apply transform scale-95;
    }
    .fnsku-row {
        @apply bg-fnsku;
    }
    /* 未匹配 FNSKU 提示框样式 */
    .bg-amber-50 {
        background-color: #fffbeb;
    }
    .border-amber-200 {
        border-color: #fcd34d;
    }
    .text-amber-700 {
        color: #b45309;
    }
    .text-amber-800 {
        color: #78350f;
    }
    .whitespace-pre-line {
        white-space: pre-line;
    }
}
    </style>
</head>
<body class="bg-gray-50 min-h-screen py-8 px-4 md:px-8">
    <div class="max-w-6xl mx-auto">
        <!-- 页面标题 -->
        <header class="mb-8 text-center">
            <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-gray-800 mb-2 text-shadow">
                <i class="fa fa-wrench mr-3"></i>数据处理工具集
            </h1>
        </header>

        <!-- 标签页导航（新增表格处理工具标签） -->
        <div class="border-b border-gray-200 mb-6">
            <nav class="-mb-px flex flex-wrap">
                <button id="tab1Btn" class="tab-active py-4 px-6 border-b-2 font-medium text-sm transition-colors">
                    <i class="fa fa-calculator mr-2"></i>Serenity工具
                </button>
                <button id="tab2Btn" class="py-4 px-6 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm transition-colors">
                    <i class="fa fa-exchange mr-2"></i>MSKU数据匹配工具
                </button>
                <button id="tab3Btn" class="py-4 px-6 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm transition-colors">
                    <i class="fa fa-file-text-o mr-2"></i>空行转换
                </button>
                <!-- 新增表格处理工具标签 -->
                <button id="tab4Btn" class="py-4 px-6 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm transition-colors">
                    <i class="fa fa-table mr-2"></i>表格处理工具
                </button>
            </nav>
        </div>

        <!-- 第一个工具：Serenity工具（新增独立复制按钮） -->
        <div id="tab1Content" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                
                <div class="p-6">
                    <!-- 输入输出区域采用网格布局 -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <!-- 输入框区域（带清空按钮） -->
                        <div class="space-y-2">
                            <div class="flex justify-between items-center">
                                <label class="block text-neutral font-medium">
                                    <i class="fa fa-paste mr-2"></i>输入数据
                                </label>
                                <button 
                                    id="clearSerenityInput"
                                    class="text-danger hover:text-danger/80 text-sm flex items-center transition-colors"
                                >
                                    <i class="fa fa-trash-o mr-1"></i> 清空
                                </button>
                            </div>
                            <textarea 
                                id="inputData" 
                                class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all h-[300px] resize-none"
                                placeholder="请粘贴数据，例如：&#10;2xnshjdgdgdsf58sdhjxb89     2&#10;2xnshjdgdpoiu254dffff875     2&#10;xixihaha233yiyihahopiuh8      5"
                            ></textarea>
                            <p class="text-xs text-gray-500">格式：每行一条，用空格分隔两列</p>
                        </div>
                        
                        <!-- 第一列结果（新增独立复制按钮） -->
                        <div class="space-y-2">
                            <div class="flex justify-between items-center">
                                <label class="block text-neutral font-medium">
                                    <i class="fa fa-list-ol mr-2"></i>第一列数据
                                </label>
                                <button 
                                    onclick="copyToClipboard1('firstColumn', '第一列数据')"
                                    class="bg-primary/10 hover:bg-primary/20 text-primary text-sm px-3 py-1 rounded flex items-center transition-colors"
                                >
                                    <i class="fa fa-copy mr-1"></i> 复制
                                </button>
                            </div>
                            <div class="relative h-[300px]">
                                <textarea 
                                    id="firstColumn" 
                                    class="w-full p-4 border border-gray-300 rounded-lg bg-gray-50 h-full resize-none"
                                    readonly
                                    placeholder="第一列数据将在这里显示（英文逗号分隔）"
                                ></textarea>
                            </div>
                            <p class="text-xs text-gray-500">结果：第一列数据用英文逗号分隔</p>
                        </div>
                        
                        <!-- 第二列总和（新增独立复制按钮） -->
                        <div class="space-y-2">
                            <div class="flex justify-between items-center">
                                <label class="block text-neutral font-medium">
                                    <i class="fa fa-calculator mr-2"></i>第二列总和
                                </label>
                                <button 
                                    onclick="copyToClipboard1('sumResult', '第二列总和')"
                                    class="bg-primary/10 hover:bg-primary/20 text-primary text-sm px-3 py-1 rounded flex items-center transition-colors"
                                >
                                    <i class="fa fa-copy mr-1"></i> 复制
                                </button>
                            </div>
                            <div class="relative h-[300px]">
                                <textarea 
                                    id="sumResult" 
                                    class="w-full p-4 border border-gray-300 rounded-lg bg-gray-50 h-full resize-none"
                                    readonly
                                    placeholder="第二列数据的总和将在这里显示"
                                ></textarea>
                            </div>
                            <p class="text-xs text-gray-500">结果：第二列所有数字的总和</p>
                        </div>
                    </div>
                    
                    <!-- 处理按钮 -->
                    <div class="flex justify-center pt-2">
                        <button 
                            id="processBtn1"
                            class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-8 rounded-lg transition-all transform hover:scale-105 flex items-center"
                        >
                            <i class="fa fa-magic mr-2"></i>处理数据
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 第二个工具：MSKU数据匹配工具 -->
        <div id="tab2Content" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- 第一个输入框 -->
                <div class="bg-white rounded-xl shadow-md p-6 transform transition-all duration-300 hover:shadow-lg">
                    <div class="flex justify-between items-center mb-3">
                        <label for="input1" class="block text-gray-700 font-medium flex items-center">
                            <i class="fa fa-file-text-o mr-2 text-primary"></i>
                            输入数据 (每行一个条目)
                        </label>
                        <button id="clearInput1" class="text-danger hover:text-danger/80 text-sm flex items-center transition-colors">
                            <i class="fa fa-trash-o mr-1"></i> 清空
                        </button>
                    </div>
                    <textarea id="input1" rows="10" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all resize-none" placeholder="例如: 01-US-0210-0150-MB, 1, Please investigate"></textarea>
                </div>

                <!-- 第二个输入框 -->
                <div class="bg-white rounded-xl shadow-md p-6 transform transition-all duration-300 hover:shadow-lg">
                    <div class="flex justify-between items-center mb-3">
                        <label for="input2" class="block text-gray-700 font-medium flex items-center">
                            <i class="fa fa-table mr-2 text-primary"></i>
                            参考数据 (按列分隔)
                        </label>
                        <button id="clearInput2" class="text-danger hover:text-danger/80 text-sm flex items-center transition-colors">
                            <i class="fa fa-trash-o mr-1"></i> 清空
                        </button>
                    </div>
                    <textarea id="input2" rows="10" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all resize-none" placeholder="例如: ASIN	FNSKU	MSKU	QTY Exp	QTY Recv	QTY Ack	QTY Deny	QTY Reimb	QTY Adj	QTY Diff	Price"></textarea>
                </div>
            </div>

            <!-- 功能按钮区 -->
            <div class="flex flex-col sm:flex-row justify-center gap-4 mb-8">
                <button id="processBtn2" class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-8 rounded-lg shadow transition-all duration-300 flex items-center justify-center">
                    <i class="fa fa-cogs mr-2"></i> 处理数据
                </button>
                <button id="copyExcelBtn" class="bg-accent hover:bg-accent/90 text-white font-medium py-3 px-8 rounded-lg shadow transition-all duration-300 flex items-center justify-center" disabled>
                    <i class="fa fa-file-excel-o mr-2"></i> 复制为Excel
                </button>
                <button id="clearAllBtn" class="bg-danger hover:bg-danger/90 text-white font-medium py-3 px-8 rounded-lg shadow transition-all duration-300 flex items-center justify-center">
                    <i class="fa fa-trash mr-2"></i> 清空所有
                </button>
            </div>

<!-- 结果区域 -->
<div id="resultContainer" class="bg-white rounded-xl shadow-md p-6 mb-8 overflow-hidden max-h-0 transition-height">
    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
        <i class="fa fa-check-circle text-accent mr-2"></i> 匹配结果
    </h2>
    <!-- 添加垂直滚动容器 -->
    <div class="msku-result-container">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <!-- 表头添加固定样式 -->
                <thead class="bg-gray-50 sticky-header">
                    <tr id="resultHeader"></tr>
                </thead>
                <tbody id="resultBody" class="bg-white divide-y divide-gray-200"></tbody>
            </table>
        </div>
    </div>
    
    <!-- 新增：未匹配 FNSKU 提示框 -->
    <div id="unmatched-fnsku-container" class="mt-4 hidden">
        <label class="block text-sm font-medium text-amber-700 mb-2">
            <i class="fa fa-exclamation-circle mr-1"></i>未匹配成功的 FNSKU
        </label>
        <div class="border border-amber-200 rounded-lg bg-amber-50 p-3 text-amber-800">
            <p id="unmatched-fnsku-content" class="whitespace-pre-line"></p>
        </div>
    </div>
</div>

        <!-- 状态提示 -->
        <div id="statusMessage" class="hidden fixed bottom-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-xs"></div>
    </div>

<!-- 第三个工具：空行与分隔符转换工具 -->
<div id="tab3Content" class="tab-content hidden">
    <div class="max-w-6xl mx-auto">

        <!-- 功能按钮区域 -->
        <section class="bg-white rounded-xl shadow-lg p-4 mb-6">
            <h3 class="text-lg font-semibold mb-4 flex items-center">
                <i class="fa fa-wrench text-primary mr-2"></i>处理功能
            </h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3">
                <!-- 空行处理 -->
                <div class="p-3 border border-gray-200 rounded-lg bg-gray-50">
                    <h4 class="font-medium mb-2 text-gray-700 text-sm">空行处理</h4>
                    <div class="flex flex-col space-y-2">
                        <button id="remove-extra-lines" class="flex items-center justify-center px-3 py-1.5 bg-primary text-white rounded-md hover:bg-primary/80 transition-colors text-sm">
                            <i class="fa fa-compress mr-1.5"></i>去除多余空行
                        </button>
<button id="remove-all-lines" class="flex items-center justify-center px-3 py-1.5 bg-primary text-white rounded-md hover:bg-primary/80 transition-colors text-sm">
    <i class="fa fa-cut mr-1.5"></i>完全去除空行
</button>
                    </div>
                </div>
                <!-- 分隔符转换行 -->
                <div class="p-3 border border-gray-200 rounded-lg bg-gray-50">
                    <h4 class="font-medium mb-2 text-gray-700 text-sm">分隔符转换行</h4>
                    <div class="flex items-center space-x-2">
                        <input type="text" id="delimiter" class="flex-grow px-2 py-1.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary transition-all text-sm" placeholder="输入分隔符" value=",">
                        <button id="delimiter-to-line" class="px-3 py-1.5 bg-secondary text-white rounded-md hover:bg-secondary/90 transition-colors text-sm">
                            <i class="fa fa-arrow-down mr-1"></i>转换
                        </button>
                    </div>
                </div>
                <!-- 换行转分隔符 -->
                <div class="p-3 border border-gray-200 rounded-lg bg-gray-50">
                    <h4 class="font-medium mb-2 text-gray-700 text-sm">换行转分隔符</h4>
                    <div class="flex items-center space-x-2">
                        <input type="text" id="line-to-delimiter" class="flex-grow px-2 py-1.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary transition-all text-sm" placeholder="输入分隔符" value=",">
                        <button id="line-to-delimiter-btn" class="px-3 py-1.5 bg-secondary text-white rounded-md hover:bg-secondary/90 transition-colors text-sm">
                            <i class="fa fa-arrow-right mr-1"></i>转换
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 文本输入/输出区域 -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- 输入区域 -->
            <div class="bg-white rounded-xl shadow-lg p-4 transform transition-all duration-300 hover:shadow-xl flex flex-col h-full">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-lg font-semibold flex items-center">
                        <i class="fa fa-pencil-square-o text-primary mr-2"></i>输入文本
                    </h3>
                    <div class="flex space-x-1">
                        <button id="copy-input" class="p-2 text-gray-400 hover:text-primary transition-colors" title="复制输入内容">
                            <i class="fa fa-copy"></i>
                        </button>
                        <button id="clear-input" class="p-2 text-gray-400 hover:text-danger transition-colors" title="清空输入内容">
                            <i class="fa fa-times-circle"></i>
                        </button>
                    </div>
                </div>
                <div class="relative flex-grow">
                    <textarea 
                        id="input-text" 
                        class="w-full h-full min-h-[400px] p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all resize-none font-mono text-sm"
                        placeholder="请在此输入需要处理的文本...&#10;示例1（多空行）：&#10;第一行&#10;&#10;&#10;第二行&#10;第三行&#10;&#10;第四行&#10;示例2（分隔符）：&#10;a,b,c,d,e&#10;1;2;3;4;5"></textarea>
                </div>
                <div id="copy-input-alert" class="hidden mt-2 text-sm text-primary flex items-center justify-center">
                    <i class="fa fa-check-circle mr-1"></i>输入内容已复制
                </div>
            </div>

            <!-- 输出区域 -->
            <div class="bg-white rounded-xl shadow-lg p-4 transform transition-all duration-300 hover:shadow-xl flex flex-col h-full">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-lg font-semibold flex items-center">
                        <i class="fa fa-check-square-o text-secondary mr-2"></i>处理结果
                    </h3>
                    <div class="flex space-x-1">
                        <button id="copy-output" class="p-2 text-gray-400 hover:text-secondary transition-colors" title="复制结果内容">
                            <i class="fa fa-copy"></i>
                        </button>
                        <button id="clear-output" class="p-2 text-gray-400 hover:text-danger transition-colors" title="清空结果内容">
                            <i class="fa fa-times-circle"></i>
                        </button>
                    </div>
                </div>
                <div class="relative flex-grow">
                    <textarea 
                        id="output-text" 
                        class="w-full h-full min-h-[400px] p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-secondary focus:border-secondary transition-all resize-none font-mono text-sm"
                        placeholder="处理后的文本将显示在这里..." readonly></textarea>
                </div>
                <div id="copy-output-alert" class="hidden mt-2 text-sm text-secondary flex items-center justify-center">
                    <i class="fa fa-check-circle mr-1"></i>结果内容已复制
                </div>
            </div>
        </section>

        <!-- 使用说明 -->
        <section class="bg-white rounded-xl shadow-lg p-4 mb-6">
            <h3 class="text-lg font-semibold mb-3 flex items-center">
                <i class="fa fa-info-circle text-primary mr-2"></i>使用说明
            </h3>
            <div class="text-gray-600 space-y-2 text-sm">
                <div class="flex items-start">
                    <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                    <p><strong>去除多余空行</strong>：将连续多个空行压缩为一个空行（保留合理换行）</p>
                </div>
                <div class="flex items-start">
                    <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                    <p><strong>完全去除空行</strong>：删除文本中所有空行（适合紧凑格式需求）</p>
                </div>
                <div class="flex items-start">
                    <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                    <p><strong>分隔符转换行</strong>：将指定分隔符（如逗号、分号）分隔的内容，转为每行一个</p>
                </div>
                <div class="flex items-start">
                    <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                    <p><strong>换行转分隔符</strong>：将每行内容用指定分隔符连接（如换行转逗号，生成CSV格式）</p>
                </div>
            </div>
        </section>
    </div>
</div>

<!-- 新增：第四个工具 - 表格处理工具 -->
<div id="tab4Content" class="tab-content hidden">
    <div class="bg-white rounded-xl shadow-md p-5 mb-6">
        <!-- 操作按钮（顶部） -->
        <div class="flex flex-wrap gap-3 mb-5">
            <button 
                id="table_clearZerosBtn" 
                class="bg-secondary hover:bg-secondary/90 text-white px-5 py-2.5 rounded-lg flex items-center gap-2 transition-all shadow-sm hover:shadow active:btn-active"
            >
                <i class="fa fa-eraser"></i> 清除0值
            </button>
            <button 
                id="table_copyBtn" 
                class="bg-primary hover:bg-primary/90 text-white px-5 py-2.5 rounded-lg flex items-center gap-2 transition-all shadow-sm hover:shadow active:btn-active"
            >
                <i class="fa fa-copy"></i> 复制为Excel格式
            </button>
            <button 
                id="table_resetBtn" 
                class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-5 py-2.5 rounded-lg flex items-center gap-2 transition-all active:btn-active"
            >
                <i class="fa fa-refresh"></i> 重置
            </button>
            <div id="table_copyStatus" class="hidden ml-2 flex items-center text-sm"></div>
        </div>

        <!-- 输入区域 -->
        <div class="mb-5">
            <label for="table_sourceInput" class="block text-sm font-medium text-gray-700 mb-2">输入框 - 粘贴表格数据：</label>
            <textarea 
                id="table_sourceInput" 
                class="w-full h-36 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all resize-none"
                placeholder="在此粘贴表格数据，会自动转换为带行列的表格..."
            ></textarea>
        </div>

        <!-- 表格显示区域（可左右滑动） -->
        <div class="mb-2">
            <label class="block text-sm font-medium text-gray-700 mb-2">表格预览（可左右滑动查看完整内容）：</label>
            <div class="overflow-x-auto" style="padding-bottom: 4px;">
                <div id="table_tableOutput" class="border border-gray-200 rounded-lg min-w-full max-h-96 overflow-y-auto">
                    <div class="flex items-center justify-center h-40 text-gray-500 border-b border-gray-200">
                        粘贴数据后表格将显示在这里
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <script>
// 标签页切换功能（新增表格工具切换逻辑）
document.getElementById('tab1Btn').addEventListener('click', function() {
    // 显示Serenity工具，隐藏其他
    document.getElementById('tab1Content').classList.remove('hidden');
    document.getElementById('tab2Content').classList.add('hidden');
    document.getElementById('tab3Content').classList.add('hidden');
    document.getElementById('tab4Content').classList.add('hidden');
    // 更新按钮样式
    document.getElementById('tab1Btn').classList.add('tab-active');
    document.getElementById('tab2Btn').classList.remove('tab-active');
    document.getElementById('tab3Btn').classList.remove('tab-active');
    document.getElementById('tab4Btn').classList.remove('tab-active');
    document.getElementById('tab2Btn').classList.add('text-gray-500', 'border-transparent');
    document.getElementById('tab3Btn').classList.add('text-gray-500', 'border-transparent');
    document.getElementById('tab4Btn').classList.add('text-gray-500', 'border-transparent');
});
document.getElementById('tab2Btn').addEventListener('click', function() {
    // 显示MSKU工具，隐藏其他
    document.getElementById('tab2Content').classList.remove('hidden');
    document.getElementById('tab1Content').classList.add('hidden');
    document.getElementById('tab3Content').classList.add('hidden');
    document.getElementById('tab4Content').classList.add('hidden');
    // 更新按钮样式
    document.getElementById('tab2Btn').classList.add('tab-active');
    document.getElementById('tab1Btn').classList.remove('tab-active');
    document.getElementById('tab3Btn').classList.remove('tab-active');
    document.getElementById('tab4Btn').classList.remove('tab-active');
    document.getElementById('tab1Btn').classList.add('text-gray-500', 'border-transparent');
    document.getElementById('tab3Btn').classList.add('text-gray-500', 'border-transparent');
    document.getElementById('tab4Btn').classList.add('text-gray-500', 'border-transparent');
});
document.getElementById('tab3Btn').addEventListener('click', function() {
    // 显示空行与分隔符工具，隐藏其他
    document.getElementById('tab3Content').classList.remove('hidden');
    document.getElementById('tab1Content').classList.add('hidden');
    document.getElementById('tab2Content').classList.add('hidden');
    document.getElementById('tab4Content').classList.add('hidden');
    // 更新按钮样式
    document.getElementById('tab3Btn').classList.add('tab-active');
    document.getElementById('tab1Btn').classList.remove('tab-active');
    document.getElementById('tab2Btn').classList.remove('tab-active');
    document.getElementById('tab4Btn').classList.remove('tab-active');
    document.getElementById('tab1Btn').classList.add('text-gray-500', 'border-transparent');
    document.getElementById('tab2Btn').classList.add('text-gray-500', 'border-transparent');
    document.getElementById('tab4Btn').classList.add('text-gray-500', 'border-transparent');
});
// 新增表格处理工具切换逻辑
document.getElementById('tab4Btn').addEventListener('click', function() {
    // 显示表格工具，隐藏其他
    document.getElementById('tab4Content').classList.remove('hidden');
    document.getElementById('tab1Content').classList.add('hidden');
    document.getElementById('tab2Content').classList.add('hidden');
    document.getElementById('tab3Content').classList.add('hidden');
    // 更新按钮样式
    document.getElementById('tab4Btn').classList.add('tab-active');
    document.getElementById('tab1Btn').classList.remove('tab-active');
    document.getElementById('tab2Btn').classList.remove('tab-active');
    document.getElementById('tab3Btn').classList.remove('tab-active');
    document.getElementById('tab1Btn').classList.add('text-gray-500', 'border-transparent');
    document.getElementById('tab2Btn').classList.add('text-gray-500', 'border-transparent');
    document.getElementById('tab3Btn').classList.add('text-gray-500', 'border-transparent');
});

        // 显示状态消息（全局通用）
        function showStatus(message, isError = false) {
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.textContent = message;
            statusMessage.className = `fixed bottom-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-xs transition-all duration-300 ${
                isError ? 'bg-red-100 text-red-800 border border-red-200' : 'bg-green-100 text-green-800 border border-green-200'
            }`;
            statusMessage.classList.remove('hidden');
            
            setTimeout(() => {
                statusMessage.classList.add('opacity-0');
                setTimeout(() => statusMessage.classList.add('hidden'), 300);
            }, 3000);
        }

        // Serenity工具功能（优化版）
        function processData1() {
            const input = document.getElementById('inputData').value.trim();
            const firstColumnOutput = document.getElementById('firstColumn');
            const sumResultOutput = document.getElementById('sumResult');
            
            // 清空输出
            firstColumnOutput.value = '';
            sumResultOutput.value = '';
            
            if (!input) {
                showStatus('请先输入数据', true);
                return;
            }
            
            // 按行分割
            const lines = input.split('\n');
            const firstColumn = [];
            let sum = 0;
            let invalidLines = [];
            
            // 处理每一行
            lines.forEach((line, index) => {
                // 用正则分割，匹配一个或多个空白字符
                const parts = line.split(/\s+/);
                
                if (parts.length >= 2) {
                    firstColumn.push(parts[0]);
                    
                    // 尝试将第二部分转换为数字
                    const num = parseFloat(parts[1]);
                    if (!isNaN(num)) {
                        sum += num;
                    } else {
                        invalidLines.push(index + 1);
                    }
                } else {
                    console.warn(`第${index + 1}行格式不正确: ${line}`);
                }
            });
            
            // 填充结果
            firstColumnOutput.value = firstColumn.join(',');
            sumResultOutput.value = sum.toString();
            
            // 提示无效数据行
            if (invalidLines.length > 0) {
                showStatus(`注意：第 ${invalidLines.join(', ')} 行的第二列不是有效的数字，已忽略`, true);
            } else {
                showStatus('数据处理完成');
            }
            
            // 添加处理完成的动画效果
            const processBtn = document.getElementById('processBtn1');
            processBtn.classList.add('bg-secondary');
            processBtn.innerHTML = '<i class="fa fa-check mr-2"></i>处理完成';
            
            setTimeout(() => {
                processBtn.classList.remove('bg-secondary');
                processBtn.innerHTML = '<i class="fa fa-magic mr-2"></i>处理数据';
            }, 2000);
        }
        
        // Serenity工具的复制到剪贴板函数（优化反馈）
        function copyToClipboard1(elementId, label) {
            const element = document.getElementById(elementId);
            if (!element.value.trim()) {
                showStatus(`暂无${label}可复制`, true);
                return;
            }
            
            element.select();
            document.execCommand('copy');
            
            // 显示复制成功提示（双重反馈）
            showStatus(`${label}已复制到剪贴板`);
            
            // 输入框内短暂提示
            const originalText = element.value;
            element.value = `✅ ${label}已复制！`;
            
            setTimeout(() => {
                element.value = originalText;
            }, 1500);
        }
        
        // 添加Serenity工具的清空按钮功能
        document.getElementById('clearSerenityInput').addEventListener('click', function() {
            const inputData = document.getElementById('inputData');
            const firstColumn = document.getElementById('firstColumn');
            const sumResult = document.getElementById('sumResult');
            
            if (inputData.value.trim() || firstColumn.value.trim() || sumResult.value.trim()) {
                inputData.value = '';
                firstColumn.value = '';
                sumResult.value = '';
                showStatus('已清空所有内容');
            } else {
                showStatus('内容已为空', true);
            }
        });
        
        // 绑定Serenity工具的按钮点击事件
        document.getElementById('processBtn1').addEventListener('click', processData1);
        
        // Serenity工具支持按Enter键处理数据（Shift+Enter换行）
        document.getElementById('inputData').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                processData1();
            }
        });

        // MSKU数据匹配工具功能
        document.addEventListener('DOMContentLoaded', () => {
            const input1 = document.getElementById('input1');
            const input2 = document.getElementById('input2');
            const processBtn = document.getElementById('processBtn2');
            const copyExcelBtn = document.getElementById('copyExcelBtn');
            const clearInput1 = document.getElementById('clearInput1');
            const clearInput2 = document.getElementById('clearInput2');
            const clearAllBtn = document.getElementById('clearAllBtn');
            const resultContainer = document.getElementById('resultContainer');
            const resultHeader = document.getElementById('resultHeader');
            const resultBody = document.getElementById('resultBody');
            let resultsData = [];

            // 清空单个输入框
            function clearSingleInput(inputElement, inputName) {
                if (inputElement.value.trim() !== '') {
                    inputElement.value = '';
                    showStatus(`已清空${inputName}`);
                } else {
                    showStatus(`${inputName}已为空`, true);
                }
            }

            // 清空所有输入框和结果
            function clearAllData() {
                input1.value = '';
                input2.value = '';
                resultBody.innerHTML = '';
                resultContainer.style.maxHeight = '0';
                copyExcelBtn.disabled = true;
                resultsData = [];
                // 清空未匹配提示框
                document.getElementById('unmatched-fnsku-container').classList.add('hidden');
                showStatus('已清空所有数据');
            }

            // 绑定清空按钮事件
            clearInput1.addEventListener('click', () => clearSingleInput(input1, '输入数据'));
            clearInput2.addEventListener('click', () => clearSingleInput(input2, '参考数据'));
            clearAllBtn.addEventListener('click', clearAllData);

            // 处理数据
            processBtn.addEventListener('click', () => {
                try {
// 解析第一个输入框的数据（按倒数前两个逗号分割）
const input1Lines = input1.value.trim().split('\n')
    .filter(line => line.trim() !== '')
    .map(line => {
        const lineTrimmed = line.trim();
        // 找到所有逗号的索引位置
        const commaIndices = [];
        for (let i = 0; i < lineTrimmed.length; i++) {
            if (lineTrimmed[i] === ',') commaIndices.push(i);
        }
        
        let msku, requestQty, status;
        // 情况1：逗号数量 >=2（满足倒数两个逗号的条件）
        if (commaIndices.length >= 2) {
            // 倒数第二个逗号的位置（分割MSKU和数量的边界）
            const secondLastCommaIdx = commaIndices[commaIndices.length - 2];
            // 倒数第一个逗号的位置（分割数量和状态的边界）
            const lastCommaIdx = commaIndices[commaIndices.length - 1];
            
            // MSKU：从开头到倒数第二个逗号（含中间逗号，如"UD-Black,M-3pac"）
            msku = lineTrimmed.slice(0, secondLastCommaIdx).trim();
            // 数量：倒数第二个逗号到倒数第一个逗号之间的内容
            requestQty = parseFloat(lineTrimmed.slice(secondLastCommaIdx + 1, lastCommaIdx).trim());
            // 状态：倒数第一个逗号之后的内容（保留原格式）
            status = lineTrimmed.slice(lastCommaIdx + 1).trim();
        } 
        // 情况2：逗号数量 <2（兼容原有格式，按原逻辑分割）
        else {
            const parts = lineTrimmed.split(',').map(part => part.trim());
            msku = parts[0] || '';
            requestQty = parts.length >=2 ? parseFloat(parts[1]) : NaN;
            status = parts.slice(2).join(', ') || '';
        }
        
        return {
            msku: msku,
            requestQty: isNaN(requestQty) ? 0 : requestQty, // 无效数量默认0
            status: status
        };
    });

                    if (input1Lines.length === 0) {
                        showStatus('请在第一个输入框中输入数据', true);
                        return;
                    }

                    // 解析第二个输入框的数据
                    const input2Lines = input2.value.trim().split('\n')
                        .filter(line => line.trim() !== '');
                    
                    if (input2Lines.length < 2) {
                        showStatus('请在第二个输入框中输入有效的表格数据', true);
                        return;
                    }

                    // 解析表头
                    const headers = input2Lines[0].split(/\t+/);
                    const mskuIndex = headers.indexOf('MSKU');
                    const fnskuIndex = headers.indexOf('FNSKU');
                    const qtyAdjIndex = headers.indexOf('QTY Adj');
                    const qtyDiffIndex = headers.indexOf('QTY Diff');

                    if (mskuIndex === -1 || fnskuIndex === -1 || qtyAdjIndex === -1 || qtyDiffIndex === -1) {
                        showStatus('第二个输入框中缺少必要的列(MSKU, FNSKU, QTY Adj, QTY Diff)', true);
                        return;
                    }

                    // 解析数据行并保存FNSKU顺序
                    const referenceData = {};
                    const fnskuOrder = [];
                    
                    input2Lines.slice(1).forEach(line => {
                        const parts = line.split(/\t+/);
                        const msku = parts[mskuIndex];
                        const fnsku = parts[fnskuIndex];
                        
                        referenceData[msku] = {
                            fnsku: fnsku,
                            qtyAdj: parseFloat(parts[qtyAdjIndex] || 0),
                            qtyDiff: parseFloat(parts[qtyDiffIndex] || 0)
                        };
                        
                        if (!fnskuOrder.includes(fnsku)) {
                            fnskuOrder.push(fnsku);
                        }
                    });


// 匹配数据 - 处理未匹配项显示NA
const matchedData = [];
input1Lines.forEach(item => {
    if (referenceData[item.msku]) {
        // 匹配到的项正常处理
        const ref = referenceData[item.msku];
        const currentQty = ref.qtyAdj + ref.qtyDiff;
        const discrepancy = item.requestQty - currentQty;
        
        matchedData.push({
            msku: item.msku,
            requestQty: item.requestQty,
            status: item.status,
            fnsku: ref.fnsku,
            currentQty: currentQty,
            discrepancy: discrepancy
        });
    } else {
        // 未匹配到的项显示NA
        matchedData.push({
            msku: item.msku,
            requestQty: item.requestQty,
            status: item.status,
            fnsku: 'NA',
            currentQty: 'NA',
            discrepancy: 'NA'
        });
    }
});
		
                    // 按FNSKU顺序排序
                    resultsData = [...matchedData].sort((a, b) => {
                        const indexA = fnskuOrder.indexOf(a.fnsku);
                        const indexB = fnskuOrder.indexOf(b.fnsku);
                        return indexA - indexB;
                    });

                    // 显示结果
                    displayResults(resultsData);
                    
                    // 显示结果容器
                    resultContainer.style.maxHeight = '1000px';
                    
                    // 启用复制按钮
                    copyExcelBtn.disabled = false;
                    
                    showStatus(`成功处理 ${resultsData.length} 条匹配数据`);

                    // ====================== 新增：识别未匹配 FNSKU 逻辑 ======================
                    // 1. 解析参考数据中的所有 FNSKU（参考数据第二列是 FNSKU）
                    const allReferenceFNSKUs = [];
                    input2Lines.forEach(line => {
                        const columns = line.split(/\t+/).map(col => col.trim());
                        if (columns.length >= 2 && columns[1] && columns[1] !== 'FNSKU') { // 排除表头和空值
                            allReferenceFNSKUs.push(columns[1]);
                        }
                    });

                    // 2. 解析匹配结果中已成功匹配的 FNSKU（匹配结果第四列是 FNSKU）
                    const matchedFNSKUs = [];
                    resultRows = resultBody.querySelectorAll('tbody tr');
                    
                    resultRows.forEach(row => {
                        const fnskuCell = row.querySelector('td:nth-child(4)'); // 第四列是 FNSKU
                        if (fnskuCell) {
                            const fnsku = fnskuCell.textContent.trim();
                            if (fnsku && fnsku !== 'NA') { // 排除NA的未匹配项
                                matchedFNSKUs.push(fnsku);
                            }
                        }
                    });

                    // 3. 筛选未匹配的 FNSKU（参考数据有但匹配结果没有的）
                    const unmatchedFNSKUs = allReferenceFNSKUs.filter(
                        fnsku => !matchedFNSKUs.includes(fnsku)
                    );

                    // 4. 展示未匹配结果
                    const unmatchedContainer = document.getElementById('unmatched-fnsku-container');
                    const unmatchedContent = document.getElementById('unmatched-fnsku-content');
                    
                    if (unmatchedFNSKUs.length > 0) {
                        // 显示未匹配提示
                        unmatchedContent.textContent = `卖家可能未提及以下 FNSKU：${unmatchedFNSKUs.join(', ')}`;
                        unmatchedContainer.classList.remove('hidden');
                    } else {
                        // 无未匹配项时隐藏提示框
                        unmatchedContainer.classList.add('hidden');
                    }
                    // =========================================================================

                } catch (error) {
                    console.error('处理数据时出错:', error);
                    showStatus('处理数据时出错: ' + error.message, true);
                }
            });

            // 显示结果表格
            function displayResults(data) {
                // 清空现有内容
                resultHeader.innerHTML = '';
                resultBody.innerHTML = '';

                // 创建表头
                const headers = [
                    'MSKU', 
                    'request qty', 
                    'status', 
                    'FNSKU', 
                    'current qty', 
                    'discrepancy'
                ];
                
                headers.forEach(headerText => {
                    const th = document.createElement('th');
                    th.className = 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider';
                    th.textContent = headerText;
                    resultHeader.appendChild(th);
                });

                // 创建表格内容
                data.forEach((item, index) => {
                    const tr = document.createElement('tr');
                    tr.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                    tr.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.msku}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.requestQty}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.status}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.fnsku}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.currentQty}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.discrepancy}</td>
                    `;
                    resultBody.appendChild(tr);
                });
            }

            // 复制为Excel格式
            copyExcelBtn.addEventListener('click', () => {
                if (resultsData.length === 0) {
                    showStatus('没有可复制的数据', true);
                    return;
                }

                let excelText = 'MSKU\trequest qty\tstatus\tFNSKU\tcurrent qty\tdiscrepancy\n';
                
                resultsData.forEach(item => {
                    excelText += `${item.msku}\t${item.requestQty}\t${item.status}\t${item.fnsku}\t${item.currentQty}\t${item.discrepancy}\n`;
                });

                // 复制到剪贴板
                navigator.clipboard.writeText(excelText).then(() => {
                    showStatus('数据已复制到剪贴板，可以直接粘贴到Excel中');
                }).catch(err => {
                    console.error('无法复制内容: ', err);
                    showStatus('复制失败，请手动复制', true);
                });
            });

            // 添加按钮动画效果
            [processBtn, copyExcelBtn, clearAllBtn, clearInput1, clearInput2, document.getElementById('processBtn1'), document.getElementById('clearSerenityInput')].forEach(btn => {
                btn.addEventListener('click', function() {
                    this.classList.add('scale-95');
                    setTimeout(() => this.classList.remove('scale-95'), 200);
                });
            });
        });

// ---------------------- 空行与分隔符转换工具功能 ----------------------
// 获取工具DOM元素
const inputText = document.getElementById('input-text');
const outputText = document.getElementById('output-text');
const clearInputBtn = document.getElementById('clear-input');
const clearOutputBtn = document.getElementById('clear-output');
const copyInputBtn = document.getElementById('copy-input');
const copyOutputBtn = document.getElementById('copy-output');
const copyInputAlert = document.getElementById('copy-input-alert');
const copyOutputAlert = document.getElementById('copy-output-alert');
const removeExtraLinesBtn = document.getElementById('remove-extra-lines');
const removeAllLinesBtn = document.getElementById('remove-all-lines');
const delimiterInput = document.getElementById('delimiter');
const delimiterToLineBtn = document.getElementById('delimiter-to-line');
const lineToDelimiterInput = document.getElementById('line-to-delimiter');
const lineToDelimiterBtn = document.getElementById('line-to-delimiter-btn');

// 文本处理核心函数（统一处理逻辑）
function processText(processor) {
    const text = inputText.value;
    if (!text.trim()) {
        showStatus('请先输入需要处理的文本', true);
        return;
    }
    const result = processor(text);
    outputText.value = result;
    // 处理结果动画反馈
    outputText.parentElement.classList.add('ring-2', 'ring-secondary');
    setTimeout(() => {
        outputText.parentElement.classList.remove('ring-2', 'ring-secondary');
    }, 500);
    showStatus('文本处理完成');
}

// 1. 去除多余空行（连续空行保留一个）
function removeExtraEmptyLines(text) {
    return text.replace(/(\n\s*){2,}/g, '\n\n').trim() + '\n';
}

// 2. 完全去除空行（删除所有空行）
function removeAllEmptyLines(text) {
    return text.replace(/\n\s*/g, '\n').replace(/\n+/g, '\n').trim() + '\n';
}

// 3. 分隔符转换行（如"a,b,c" → "a\nb\nc"）
function delimiterToLine(text) {
    const delimiter = delimiterInput.value || ','; // 默认逗号
    // 转义正则特殊字符（如*.+?^$等）
    const escapedDelimiter = delimiter.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    return text.split(new RegExp(escapedDelimiter)).filter(item => item.trim() !== '').join('\n');
}

// 4. 换行转分隔符（如"a\nb\nc" → "a,b,c"）
function lineToDelimiter(text) {
    const delimiter = lineToDelimiterInput.value || ','; // 默认逗号
    return text.split('\n').filter(item => item.trim() !== '').join(delimiter);
}

// 绑定按钮事件：清空输入（修改后的新代码）
clearInputBtn.addEventListener('click', () => {
    inputText.value = ''; // 保留原有逻辑：清空输入框
    outputText.value = ''; // 新增逻辑：同时清空结果框（关键修改）
    inputText.focus(); // 保留原有逻辑：光标回到输入框
    showStatus('输入框和结果框已清空'); // 新增逻辑：更新提示文本，告知用户两个框都已清空（关键修改）
});

// 绑定按钮事件：清空输出
clearOutputBtn.addEventListener('click', () => {
    outputText.value = '';
    showStatus('结果框已清空');
});

// 绑定按钮事件：复制输入
copyInputBtn.addEventListener('click', () => {
    if (inputText.value) {
        inputText.select();
        document.execCommand('copy');
        copyInputAlert.classList.remove('hidden');
        setTimeout(() => copyInputAlert.classList.add('hidden'), 2000);
        showStatus('输入内容已复制');
    } else {
        showStatus('输入框为空，无内容可复制', true);
    }
});

// 绑定按钮事件：复制输出
copyOutputBtn.addEventListener('click', () => {
    if (outputText.value) {
        outputText.select();
        document.execCommand('copy');
        copyOutputAlert.classList.remove('hidden');
        setTimeout(() => copyOutputAlert.classList.add('hidden'), 2000);
        showStatus('结果内容已复制');
    } else {
        showStatus('结果框为空，无内容可复制', true);
    }
});

// 绑定功能按钮事件（处理文本）
removeExtraLinesBtn.addEventListener('click', () => processText(removeExtraEmptyLines));
removeAllLinesBtn.addEventListener('click', () => processText(removeAllEmptyLines));
delimiterToLineBtn.addEventListener('click', () => processText(delimiterToLine));
lineToDelimiterBtn.addEventListener('click', () => processText(lineToDelimiter));

// 新增：输入框内容变化监听（放在功能按钮事件绑定后、键盘快捷键前）
inputText.addEventListener('input', function() {
    if (this.value.trim() === '') {
        outputText.value = '';
    }
});

// 键盘快捷键：Ctrl+Enter 触发"去除多余空行"
inputText.addEventListener('keydown', (e) => {
    if (e.ctrlKey && e.key === 'Enter') {
        e.preventDefault();
        processText(removeExtraEmptyLines);
    }
});

// 给新工具按钮添加点击动画（和其他工具保持一致）
[removeExtraLinesBtn, removeAllLinesBtn, delimiterToLineBtn, lineToDelimiterBtn, copyInputBtn, copyOutputBtn, clearInputBtn, clearOutputBtn].forEach(btn => {
    btn.addEventListener('click', function() {
        this.classList.add('scale-95');
        setTimeout(() => this.classList.remove('scale-95'), 200);
    });
});

// ---------------------- 新增：表格处理工具功能 ----------------------
// 所有ID添加table_前缀，避免冲突
const table_sourceInput = document.getElementById('table_sourceInput');
const table_tableOutput = document.getElementById('table_tableOutput');
const table_clearZerosBtn = document.getElementById('table_clearZerosBtn');
const table_copyBtn = document.getElementById('table_copyBtn');
const table_resetBtn = document.getElementById('table_resetBtn');
const table_copyStatus = document.getElementById('table_copyStatus');

// 存储表格数据和行状态
let table_tableData = [];
let table_rowStatus = []; // 存储每行是否包含FNSKU的状态

// 检查单元格是否包含FNSKU数据
function table_hasFNSKU(cellValue) {
    // 简单判断：包含"FNSKU"字符串或看起来像FNSKU格式的内容
    return cellValue && (
        cellValue.includes('FNSKU') || 
        /^[A-Z0-9]{10,15}$/.test(cellValue) // 假设FNSKU是10-15位字母数字组合
    );
}

// 将输入文本转换为表格数据
function table_parseTableData(text) {
    if (!text.trim()) return [];
    
    // 按行分割
    const rows = text.split(/\r?\n/).filter(row => row.trim() !== '');
    
    // 按制表符或多个空格分割列（处理表格格式）
    const data = rows.map(row => {
        return row.split(/\t| {2,}/).map(cell => cell.trim());
    });
    
    // 更新行状态（检查第一列是否包含FNSKU）
    table_rowStatus = data.map(row => row.length > 0 && table_hasFNSKU(row[0]));
    
    return data;
}

// 渲染表格到输出区域
function table_renderTable() {
    if (table_tableData.length === 0) {
        table_tableOutput.innerHTML = `
            <div class="flex items-center justify-center h-40 text-gray-500 border-b border-gray-200">
                粘贴数据后表格将显示在这里
            </div>
        `;
        return;
    }

    // 创建表格元素
    let tableHtml = `
        <table class="min-w-full divide-y divide-gray-200">
            <tbody class="bg-white divide-y divide-gray-200">
    `;

    // 生成表格行和列
    table_tableData.forEach((row, rowIndex) => {
        // 检查是否需要标记为FNSKU行
        const isFNSKURow = table_rowStatus[rowIndex] || false;
        const rowClass = isFNSKURow 
            ? 'fnsku-row' 
            : (rowIndex % 2 === 0 ? 'bg-gray-50' : 'bg-white');
        
        tableHtml += `<tr class="${rowClass}">`;
        
        row.forEach(cell => {
            tableHtml += `
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 border-r border-gray-100 last:border-r-0 table-cell-hover">
                    ${cell || ''}
                </td>
            `;
        });
        
        // 补全缺失的单元格，确保列数一致
        const maxColumns = Math.max(...table_tableData.map(r => r.length));
        for (let i = row.length; i < maxColumns; i++) {
            tableHtml += `
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 border-r border-gray-100 last:border-r-0 table-cell-hover">
                </td>
            `;
        }
        
        tableHtml += `</tr>`;
    });

    tableHtml += `
            </tbody>
        </table>
    `;

    table_tableOutput.innerHTML = tableHtml;
}

// 监听输入变化，自动转换为表格
table_sourceInput.addEventListener('input', () => {
    const inputText = table_sourceInput.value;
    table_tableData = table_parseTableData(inputText);
    table_renderTable();
});

// 清除所有0值
table_clearZerosBtn.addEventListener('click', () => {
    if (table_tableData.length === 0) {
        showStatus('请先粘贴表格数据', true);
        return;
    }

    // 遍历表格数据，清除0值
    table_tableData = table_tableData.map(row => {
        return row.map(cell => {
            // 严格匹配数值0
            return cell === '0' ? '' : cell;
        });
    });

    table_renderTable();
    showStatus('已成功清除所有0值');
});

// 复制为Excel格式（带FNSKU标记）
table_copyBtn.addEventListener('click', () => {
    if (table_tableData.length === 0) {
        showStatus('请先粘贴表格数据', true);
        return;
    }

    // 创建一个临时表格用于复制（支持样式）
    const tempTable = document.createElement('table');
    tempTable.style.position = 'fixed';
    tempTable.style.opacity = '0';
    
    // 创建表格内容和样式
    let tableHtml = '<tbody>';
    table_tableData.forEach((row, rowIndex) => {
        const isFNSKURow = table_rowStatus[rowIndex] || false;
        tableHtml += `<tr style="${isFNSKURow ? 'background-color: #eff6ff;' : ''}">`;
        
        row.forEach(cell => {
            tableHtml += `<td style="padding: 2px 4px; border: 1px solid #eee;">${cell || ''}</td>`;
        });
        
        // 补全缺失的单元格
        const maxColumns = Math.max(...table_tableData.map(r => r.length));
        for (let i = row.length; i < maxColumns; i++) {
            tableHtml += `<td style="padding: 2px 4px; border: 1px solid #eee;"></td>`;
        }
        
        tableHtml += '</tr>';
    });
    tableHtml += '</tbody>';
    
    tempTable.innerHTML = tableHtml;
    document.body.appendChild(tempTable);
    
    // 选择并复制表格
    const range = document.createRange();
    range.selectNode(tempTable);
    window.getSelection().removeAllRanges();
    window.getSelection().addRange(range);
    
    try {
        const successful = document.execCommand('copy');
        if (successful) {
            showStatus('已复制为Excel格式（包含FNSKU标记）');
            
            // 显示复制成功的图标
            table_copyStatus.innerHTML = '<i class="fa fa-check text-green-500 mr-1"></i> 已复制';
            table_copyStatus.classList.remove('hidden', 'text-red-500');
            table_copyStatus.classList.add('text-green-500');
        } else {
            throw new Error('复制命令执行失败');
        }
    } catch (err) {
        showStatus('复制失败，请手动复制', true);
        console.error('复制失败:', err);
        
        table_copyStatus.innerHTML = '<i class="fa fa-times text-red-500 mr-1"></i> 复制失败';
        table_copyStatus.classList.remove('hidden', 'text-green-500');
        table_copyStatus.classList.add('text-red-500');
    } finally {
        document.body.removeChild(tempTable);
        window.getSelection().removeAllRanges();
        
        setTimeout(() => {
            table_copyStatus.classList.add('hidden');
        }, 2000);
    }
});

// 重置功能
table_resetBtn.addEventListener('click', () => {
    table_sourceInput.value = '';
    table_tableData = [];
    table_rowStatus = [];
    table_renderTable();
    showStatus('已重置');
    table_copyStatus.classList.add('hidden');
});

// 给表格工具按钮添加点击动画（和其他工具保持一致）
[table_clearZerosBtn, table_copyBtn, table_resetBtn].forEach(btn => {
    btn.addEventListener('click', function() {
        this.classList.add('scale-95');
        setTimeout(() => this.classList.remove('scale-95'), 200);
    });
});
    </script>
</body>
</html>
